<!DOCTYPE html><!--lLKmyGbgC9GZXyGPxKThQ--><html lang="en"><head><meta charSet="UTF-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/lento-remake/demo.png"/><link rel="preload" as="image" href="/images/lento-remake/binary.png"/><link rel="stylesheet" href="/_next/static/css/0f63a619df29c78b.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/5eacd01f773eed7f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-6b8b512d4121474e.js"/><script src="/_next/static/chunks/4bd1b696-c023c6e3521b1417.js" async=""></script><script src="/_next/static/chunks/255-a7ba4d37dca2f1fa.js" async=""></script><script src="/_next/static/chunks/main-app-bdb7cdcf0fbe007a.js" async=""></script><script src="/_next/static/chunks/619-ba102abea3e3d0e4.js" async=""></script><script src="/_next/static/chunks/app/%5Bslug%5D/page-a8d66757df33bd31.js" async=""></script><title>Remaking a dead Multiplayer Java Game - Lentokonepeli - Matt&#x27;s Blog</title><meta name="description" content="So close, yet so far from success."/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body id="main" class="main px-5 pb-10 max-w-5xl m-auto"><div hidden=""><!--$--><!--/$--></div><div><div class="flex flex-wrap p-1 sm:p-3"><a class="mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-bold" href="/">Blog</a><a class="mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-normal" href="/projects/">Projects</a><a class="mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-normal" href="/travel/">Travel</a><a class="mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-normal" href="/about/">About Me</a><a class="mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all " target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLScM11T5L9SjhZ1c9A3OB7aWc6DuLYTzf9DStnFkalDKaKDpaA/viewform?usp=sharing&amp;ouid=112011499277324502181">Contact</a></div><div class="md:flex md:justify-center"><article class="prose md:prose-lg lg:prose-xl mt-16"><h1 class="mb-0">Remaking a dead Multiplayer Java Game - Lentokonepeli</h1><div class="italic text-gray-500">So close, yet so far from success.</div><div class="text-gray-400">August 24, 2020</div><div class="mt-6"><h2>Lentokonepeli</h2>
<p>When I was a teen I used to play on a gaming website called
<a href="https://en.wikipedia.org/wiki/Playforia" target="_blank" class="underline">Playforia</a> around 2008.
It was built on Java and had a sizeable community of players from around the world.
They had many multiplayer games such as pool, cannons, minigolf, and many more.
Since all of the games were custom made for the website,
it created a wholesome feeling of community fun.</p>
<p>One of my favorite games was a game called <a href="https://www.youtube.com/watch?v=qCCCUXUwlT8" target="_blank" class="underline">Dogfight</a>, (Lentokonepeli in Finnish).
It was a World-War-1 themed airplane combat game which pit the Central team vs. the Allies.
The first team to destroy the other&#x27;s aircraft hangars was declared the winner.
This innocuous looking game was easy to start playing, yet had a very high skill ceiling.
But most of all, it was fun. Lots of fun.
Clans formed over time and competed against each other.
Some dedicated players had spent thousands of hours mastering the mechanics of the game
in order to out-gun other players.
I had played this pretty routinely back in the day.</p>
<p><img src="/images/lento-remake/demo.png" alt="demo"/></p>
<div class="subtitle"><p>A screenshot from live gameplay of my remake.</p></div>
<p>A few years ago in 2018, I randomly remembered this game, and thought I&#x27;d go check it out.
To my surprise, there were no available rooms to join, and no active players at all. It was a ghost town.
A large part of the decline in the website&#x27;s overall popularity was because it was built on Java.
As major web browsers began to phase out Java, it slowly strangled the playerbase to death.
Seeing the writing on the wall,
I downloaded the <a href="https://github.com/mattbruv/playray-dogfight-client" target="_blank" class="underline">client-side JAR file</a>
from the server to preserve what I could.
Less than a few months later, the website admitted defeat and shut its doors permanently.</p>
<p>With the death of the website, many fans and players lost access to their favorite games and community.
Around 2019, I had the idea of trying to remake the game.
It seemed simple enough, and I also liked the idea of a free, open source version
that could be preserved and maintained forever, not being owned by a single company.
I had the game&#x27;s original assets, images, sounds, and client-side code.
Could that be enough?</p>
<h2>Creating a Remake</h2>
<p>I made <a href="https://discord.gg/QjtXPmx" target="_blank" class="underline">a Discord server</a> and got to work.
The modern web is the perfect coding playground to host such a game nowadays.
The rendering library PIXI.js seemed like a perfect fit for drawing the game.
I envisioned a game built on Node.js so that game logic could be written once and
shared between the server and the client.
This turned out to be a huge advantage, because I could simulate a server on the client side,
so that way a static website could run the game without needing to run on a server.
This meant that any player testing the game could load an
ordinary webpage and tweak game physics, and other settings,
getting immediate feedback in order to fine-tune the physics.</p>
<p><a href="https://mattbruv.github.io/Lentokonepeli/" target="_blank" class="underline">Here is a link</a>
to the latest version of the remake, running inside a simulated local server on your web browser.
You can jump right in and start flying planes, as well as tweak their physics values.
As you can see, a lot of the game&#x27;s functionality and physics have been implemented, but it isn&#x27;t finished.
(Press <code>D</code> to toggle a debug view)</p>
<h2>Challenges of Remaking a Game</h2>
<p>As the sole developer, I had a lot on my plate, and
I often feared I had bitten off more than I could chew.
In order for the game to feel the same, I needed to simulate it
as accurately as possible.
This was made infinitely harder by the fact that the game wasn&#x27;t hosted live anymore for testing,
and was only captured in old, sparse, low-quality youtube videos.
Attempting to recreate the game put me up against a lot of interesting challenges,
most of which I was able to overcome.</p>
<p>Unfortunately, I wasn&#x27;t able to accurately reproduce the most fundamental part of the game:
The flight physics.
There was nothing in the client-side code to help me figure out how to implement them.
I had a friend who is a physics graduate try to decipher the physics,
and he got pretty close.
After weeks of tampering with the physics, we simply couldn&#x27;t capture the right feeling.
No matter how much we tweaked the physics, the loyal players who remembered the game just didn&#x27;t agree with how it felt,
and we reached a stand-still.
After spending hundreds of hours in total on this project, this is where I am choosing to leave it behind.
What we ended up with feels like a Chinese knock-off of something great.</p>
<p>Despite the sad ending, I learned a bunch of interesting things about game development
since I built everything (minus the renderer) from scratch.
I&#x27;d like to also use this blog post to
detail one of the fun things I tackled while creating the remake:</p>
<h2>Optimizing Network Traffic</h2>
<p>Surprisingly, one of the most fun and rewarding challenges was designing and optimizing the
amount of data that the game sends about these objects over the network.
The game server and client communicate over WebSockets.
The game logic runs at 60 Hz on the server,
meaning that the game calculates physics, player movement, collisions, and everything else
at 60 times per second.
It also has to broadcast this information to every connected player in
order to keep their game up to date and accurate.</p>
<p>There are many objects in the game such as
planes, pilots, bombs, bullets, airfields, the ground, and so on. They are all game objects which
can interact with each another.
Each game object has unique properties, and some can change every time the game updates.</p>
<p>For example, let&#x27;s consider the properties of an example plane in our game in JSON form:</p>
<pre><code class="hljs language-js">{
    <span class="hljs-attr">x</span>: <span class="hljs-number">994</span>,
    <span class="hljs-attr">y</span>: <span class="hljs-number">174</span>,
    <span class="hljs-attr">planeType</span>: <span class="hljs-number">7</span>,
    <span class="hljs-attr">team</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">direction</span>: <span class="hljs-number">145</span>,
    <span class="hljs-attr">health</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">fuel</span>: <span class="hljs-number">226</span>,
    <span class="hljs-attr">ammo</span>: <span class="hljs-number">90</span>,
    <span class="hljs-attr">bombs</span>: <span class="hljs-number">0</span>
}
</code></pre>
<p>As we can see, each plane has 9 properties.
After using <code>JSON.stringify</code> on the above object, we get a 100 byte string.
Now let&#x27;s pretend we have 20 players flying around in a game,
and that on average, the payload is going to stay around this size.</p>
<p>20 players * 100 bytes per update = 2000 bytes per game tick =
2000 * 60 ticks per second = 120,000 bytes per second = 7,200,000 bytes per minute =
432,000,000 bytes per hour.
432MB per hour is a lot of data being transferred for a simple 2D game with 20 players!
To put that into perspective, Fortnite uses ~100MB per hour, and CS:GO uses ~250MB.</p>
<p>We could cut the simulation down by half to 30 Hz and theoretically half our output, but then the accuracy of our game simulation suffers.
There is a better way.
It&#x27;s clear that sending the entire state of the game objects on every frame is incredibly wasteful.
Imagine if a player is standing on the ground and not moving.
Why would we keep sending the location of a player who is standing still over the network?</p>
<p>The first optimization I made was to only send changes that have happened to the game objects
since the last time they were processed.
Now this makes it so that only properties that change rapidly every tick will update (such as X and Y positions),
and things that change less frequently (fuel, bullets, bombs) will be sent out less frequently.
Unchanging properties such as the team of a plane, or the type of a plane will only be sent out
once when the object is created.</p>
<p>Let&#x27;s start with a new scenario.
A game tick has just been calculated between two players who are flying.
Both of their plane&#x27;s X and Y coordinates have been updated, and one of the plane&#x27;s
fuel has decreased.
We want to send this information in a packet to the client:</p>
<pre><code class="hljs language-js">{<span class="hljs-attr">type</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">data</span>: {<span class="hljs-number">7</span>: {<span class="hljs-number">4</span>: {<span class="hljs-attr">type</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">994</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">174</span>, <span class="hljs-attr">fuel</span>: <span class="hljs-number">226</span>}, <span class="hljs-number">5</span>: {<span class="hljs-attr">type</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">x</span>: -<span class="hljs-number">1513</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">238</span>}}}}
</code></pre>
<div class="subtitle"><p>An example packet with changes to game objects.</p></div>
<p>The highest level <code>type</code> is an enum that tells the client what type of packet is coming.
<code>data</code> holds a nested object of game objects,
and each game object holds objects which are indexed by their own unique ID&#x27;s.
Each instance of a game object only has its own changes included.</p>
<p>Our example above is a 100 byte string for two planes. It would have been 200 bytes if we used the &quot;send everything&quot;
approach with two planes.
With just a little effort we&#x27;ve already reduced the size by &gt;50%,
and the savings would be significantly greater the more planes you add.</p>
<p>Only sending a small JSON object with relevant changes to game objects already saves us
quite a bit of data,
but once again, we can do better.</p>
<h3>Binary Compression</h3>
<p>since JSON is sent over the network as a string, it has a lot of overhead.
Labels such as <code>&quot;fuel&quot;:</code>, and
characters such as <code>&quot;</code>, <code>:</code>, and <code>,</code> are all just fluff in order to keep the structure
of the JSON object in tact.
In fact, we wouldn&#x27;t even need to have these labels if we knew the order and size of the properties of
an object and sent them in a specific way every time.
By creating our own custom binary protocol, we can cram a lot of information
into a small stream of bytes.</p>
<p>The compression algorithm is as follows:</p>
<ol>
<li>Always begin each packet with 1 byte to describe the type of data being sent so the client knows how to read it.</li>
</ol>
<p>For each game object (repeat):</p>
<ol start="2">
<li>Add one byte for type of object</li>
<li>Follow that with a two byte unique ID for that object (allows 2^16 = 65,536 unique IDs for each type)</li>
<li>Use <code>n</code> number of bytes as a bitmask, where bits set to <code>1</code> are the properties that are being sent immediately proceeding this bitmask, in order.</li>
</ol>
<p>For each property set in the bitmask:</p>
<ol start="5">
<li>Write <code>n</code> bytes depending on how large the property is</li>
</ol>
<p>And repeat until the end.</p>
<p><img src="/images/lento-remake/binary.png" alt="binary"/></p>
<div class="subtitle"><p>Example packet of my custom binary game object protocol.</p></div>
<p>Applying that compression to the JSON data, we now have all of that information packed into
this little binary update which is only 20 bytes (shown as a hexadecimal string here with spaces for ease of reading):</p>
<pre><code class="hljs language-apache"><span class="hljs-attribute">07</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">43</span> <span class="hljs-number">00</span> <span class="hljs-number">03</span> E2 <span class="hljs-number">00</span> AE E2 <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">03</span> <span class="hljs-number">00</span> FA <span class="hljs-number">17</span> <span class="hljs-number">00</span> EE
</code></pre>
<p>~5x smaller than our previous optimization, and ~20x smaller than the &quot;send the world&quot; approach.</p>
<h2>Final Thoughts</h2>
<p>All and all, it was a fun project to work on,
But it was mentally taxing having to write nearly everything from scratch.
It was enjoyable to see the game start to have new life again.
At one point, we even had the programmer of the original game join our server.
He searched for the original sources to try and help us,
but they were long gone and it seems like they will never be shared if they do still exist somewhere.
I wish I were able to figure out how to fix the physics, but I can&#x27;t.
It seems like this is where this project ends for now.
If the original sources are found, or someone figures out the physics,
I will complete the game, but that doesn&#x27;t seem likely.</p></div></article></div></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-6b8b512d4121474e.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[9766,[],\"\"]\n3:I[8924,[],\"\"]\n5:I[4431,[],\"OutletBoundary\"]\n7:I[5278,[],\"AsyncMetadataOutlet\"]\n9:I[4431,[],\"ViewportBoundary\"]\nb:I[4431,[],\"MetadataBoundary\"]\nc:\"$Sreact.suspense\"\ne:I[7150,[],\"\"]\n:HL[\"/_next/static/css/0f63a619df29c78b.css\",\"style\"]\n:HL[\"/_next/static/css/5eacd01f773eed7f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"lLKmyGbgC9GZXyGPxKThQ\",\"p\":\"\",\"c\":[\"\",\"lento-remake\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"slug\",\"lento-remake\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f63a619df29c78b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"charSet\":\"UTF-8\"}],[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1.0\"}]]}],[\"$\",\"body\",null,{\"id\":\"main\",\"className\":\"main px-5 pb-10 max-w-5xl m-auto\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[[\"slug\",\"lento-remake\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5eacd01f773eed7f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L5\",null,{\"children\":[\"$L6\",[\"$\",\"$L7\",null,{\"promise\":\"$@8\"}]]}]]}],{},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],null],[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$c\",null,{\"fallback\":null,\"children\":\"$Ld\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,"f:I[2619,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-a8d66757df33bd31.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap p-1 sm:p-3\",\"children\":[[[\"$\",\"$Lf\",\"0\",{\"className\":\"mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-bold\",\"href\":\"/\",\"children\":\"Blog\"}],[\"$\",\"$Lf\",\"1\",{\"className\":\"mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-normal\",\"href\":\"/projects\",\"children\":\"Projects\"}],[\"$\",\"$Lf\",\"2\",{\"className\":\"mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-normal\",\"href\":\"/travel\",\"children\":\"Travel\"}],[\"$\",\"$Lf\",\"3\",{\"className\":\"mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all font-normal\",\"href\":\"/about\",\"children\":\"About Me\"}]],[\"$\",\"$Lf\",\"contact\",{\"className\":\"mx-3 p-1 sm:px-3 sm:py-2 rounded-lg hover:bg-gray-200 transition-all \",\"target\":\"_blank\",\"href\":\"https://docs.google.com/forms/d/e/1FAIpQLScM11T5L9SjhZ1c9A3OB7aWc6DuLYTzf9DStnFkalDKaKDpaA/viewform?usp=sharing\u0026ouid=112011499277324502181\",\"children\":\"Contact\"}]]}],[\"$\",\"div\",null,{\"className\":\"md:flex md:justify-center\",\"children\":[\"$\",\"article\",null,{\"className\":\"prose md:prose-lg lg:prose-xl mt-16\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-0\",\"children\":\"Remaking a dead Multiplayer Java Game - Lentokonepeli\"}],[\"$\",\"div\",null,{\"className\":\"italic text-gray-500\",\"children\":\"So close, yet so far from success.\"}],[\"$\",\"div\",null,{\"className\":\"text-gray-400\",\"children\":\"August 24, 2020\"}],[\"$\",\"div\",null,{\"className\":\"mt-6\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Lentokonepeli\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When I was a teen I used to play on a gaming website called\\n\",[\"$\",\"a\",null,{\"href\":\"https://en.wikipedia.org/wiki/Playforia\",\"target\":\"_blank\",\"className\":\"underline\",\"children\":\"Playforia\"}],\" around 2008.\\nIt was built on Java and had a sizeable community of players from around the world.\\nThey had many multiplayer games such as pool, cannons, minigolf, and many more.\\nSince all of the games were custom made for the website,\\nit created a wholesome feeling of community fun.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"One of my favorite games was a game called \",[\"$\",\"a\",null,{\"href\":\"https://www.youtube.com/watch?v=qCCCUXUwlT8\",\"target\":\"_blank\",\"className\":\"underline\",\"children\":\"Dogfight\"}],\", (Lentokonepeli in Finnish).\\nIt was a World-War-1 themed airplane combat game which pit the Central team vs. the Allies.\\nThe first team to destroy the other's aircraft hangars was declared the winner.\\nThis innocuous looking game was easy to start playing, yet had a very high skill ceiling.\\nBut most of all, it was fun. Lots of fun.\\nClans formed over time and competed against each other.\\nSome dedicated players had spent thousands of hours mastering the mechanics of the game\\nin order to out-gun other players.\\nI had played this pretty routinely back in the day.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/lento-remake/demo.png\",\"alt\":\"demo\"}]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"subtitle\",\"children\":[\"$\",\"p\",null,{\"children\":\"A screenshot from live gameplay of my remake.\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A few years ago in 2018, I randomly remembered this game, and thought I'd go check it out.\\nTo my surprise, there were no available rooms to join, and no active players at all. It was a ghost town.\\nA large part of the decline in the website's overall popularity was because it was built on Java.\\nAs major web browsers began to phase out Java, it slowly strangled the playerbase to death.\\nSeeing the writing on the wall,\\nI downloaded the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/mattbruv/playray-dogfight-client\",\"target\":\"_blank\",\"className\":\"underline\",\"children\":\"client-side JAR file\"}],\"\\nfrom the server to preserve what I could.\\nLess than a few months later, the website admitted defeat and shut its doors permanently.\"]}],\"\\n\",\"$L10\",\"\\n\",\"$L11\",\"\\n\",\"$L12\",\"\\n\",\"$L13\",\"\\n\",\"$L14\",\"\\n\",\"$L15\",\"\\n\",\"$L16\",\"\\n\",\"$L17\",\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\"]}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"8:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Remaking a dead Multiplayer Java Game - Lentokonepeli - Matt's Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"So close, yet so far from success.\"}]],\"error\":null,\"digest\":\"$undefined\"}\nd:\"$8:metadata\"\n"])</script><script>self.__next_f.push([1,"10:[\"$\",\"p\",null,{\"children\":\"With the death of the website, many fans and players lost access to their favorite games and community.\\nAround 2019, I had the idea of trying to remake the game.\\nIt seemed simple enough, and I also liked the idea of a free, open source version\\nthat could be preserved and maintained forever, not being owned by a single company.\\nI had the game's original assets, images, sounds, and client-side code.\\nCould that be enough?\"}]\n11:[\"$\",\"h2\",null,{\"children\":\"Creating a Remake\"}]\n"])</script><script>self.__next_f.push([1,"12:[\"$\",\"p\",null,{\"children\":[\"I made \",[\"$\",\"a\",null,{\"href\":\"https://discord.gg/QjtXPmx\",\"target\":\"_blank\",\"className\":\"underline\",\"children\":\"a Discord server\"}],\" and got to work.\\nThe modern web is the perfect coding playground to host such a game nowadays.\\nThe rendering library PIXI.js seemed like a perfect fit for drawing the game.\\nI envisioned a game built on Node.js so that game logic could be written once and\\nshared between the server and the client.\\nThis turned out to be a huge advantage, because I could simulate a server on the client side,\\nso that way a static website could run the game without needing to run on a server.\\nThis meant that any player testing the game could load an\\nordinary webpage and tweak game physics, and other settings,\\ngetting immediate feedback in order to fine-tune the physics.\"]}]\n"])</script><script>self.__next_f.push([1,"13:[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://mattbruv.github.io/Lentokonepeli/\",\"target\":\"_blank\",\"className\":\"underline\",\"children\":\"Here is a link\"}],\"\\nto the latest version of the remake, running inside a simulated local server on your web browser.\\nYou can jump right in and start flying planes, as well as tweak their physics values.\\nAs you can see, a lot of the game's functionality and physics have been implemented, but it isn't finished.\\n(Press \",[\"$\",\"code\",null,{\"children\":\"D\"}],\" to toggle a debug view)\"]}]\n14:[\"$\",\"h2\",null,{\"children\":\"Challenges of Remaking a Game\"}]\n15:[\"$\",\"p\",null,{\"children\":\"As the sole developer, I had a lot on my plate, and\\nI often feared I had bitten off more than I could chew.\\nIn order for the game to feel the same, I needed to simulate it\\nas accurately as possible.\\nThis was made infinitely harder by the fact that the game wasn't hosted live anymore for testing,\\nand was only captured in old, sparse, low-quality youtube videos.\\nAttempting to recreate the game put me up against a lot of interesting challenges,\\nmost of which I was able to overcome.\"}]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"p\",null,{\"children\":\"Unfortunately, I wasn't able to accurately reproduce the most fundamental part of the game:\\nThe flight physics.\\nThere was nothing in the client-side code to help me figure out how to implement them.\\nI had a friend who is a physics graduate try to decipher the physics,\\nand he got pretty close.\\nAfter weeks of tampering with the physics, we simply couldn't capture the right feeling.\\nNo matter how much we tweaked the physics, the loyal players who remembered the game just didn't agree with how it felt,\\nand we reached a stand-still.\\nAfter spending hundreds of hours in total on this project, this is where I am choosing to leave it behind.\\nWhat we ended up with feels like a Chinese knock-off of something great.\"}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"p\",null,{\"children\":\"Despite the sad ending, I learned a bunch of interesting things about game development\\nsince I built everything (minus the renderer) from scratch.\\nI'd like to also use this blog post to\\ndetail one of the fun things I tackled while creating the remake:\"}]\n18:[\"$\",\"h2\",null,{\"children\":\"Optimizing Network Traffic\"}]\n19:[\"$\",\"p\",null,{\"children\":\"Surprisingly, one of the most fun and rewarding challenges was designing and optimizing the\\namount of data that the game sends about these objects over the network.\\nThe game server and client communicate over WebSockets.\\nThe game logic runs at 60 Hz on the server,\\nmeaning that the game calculates physics, player movement, collisions, and everything else\\nat 60 times per second.\\nIt also has to broadcast this information to every connected player in\\norder to keep their game up to date and accurate.\"}]\n1a:[\"$\",\"p\",null,{\"children\":\"There are many objects in the game such as\\nplanes, pilots, bombs, bullets, airfields, the ground, and so on. They are all game objects which\\ncan interact with each another.\\nEach game object has unique properties, and some can change every time the game updates.\"}]\n1b:[\"$\",\"p\",null,{\"children\":\"For example, let's consider the properties of an example plane in our game in JSON form:\"}]\n"])</script><script>self.__next_f.push([1,"1c:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"{\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"x\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"994\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"y\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"174\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"planeType\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"team\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"direction\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"145\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"health\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"100\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"fuel\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"226\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"ammo\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"90\"}],\",\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"bombs\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\"\\n}\\n\"]}]}]\n"])</script><script>self.__next_f.push([1,"1d:[\"$\",\"p\",null,{\"children\":[\"As we can see, each plane has 9 properties.\\nAfter using \",[\"$\",\"code\",null,{\"children\":\"JSON.stringify\"}],\" on the above object, we get a 100 byte string.\\nNow let's pretend we have 20 players flying around in a game,\\nand that on average, the payload is going to stay around this size.\"]}]\n1e:[\"$\",\"p\",null,{\"children\":\"20 players * 100 bytes per update = 2000 bytes per game tick =\\n2000 * 60 ticks per second = 120,000 bytes per second = 7,200,000 bytes per minute =\\n432,000,000 bytes per hour.\\n432MB per hour is a lot of data being transferred for a simple 2D game with 20 players!\\nTo put that into perspective, Fortnite uses ~100MB per hour, and CS:GO uses ~250MB.\"}]\n1f:[\"$\",\"p\",null,{\"children\":\"We could cut the simulation down by half to 30 Hz and theoretically half our output, but then the accuracy of our game simulation suffers.\\nThere is a better way.\\nIt's clear that sending the entire state of the game objects on every frame is incredibly wasteful.\\nImagine if a player is standing on the ground and not moving.\\nWhy would we keep sending the location of a player who is standing still over the network?\"}]\n20:[\"$\",\"p\",null,{\"children\":\"The first optimization I made was to only send changes that have happened to the game objects\\nsince the last time they were processed.\\nNow this makes it so that only properties that change rapidly every tick will update (such as X and Y positions),\\nand things that change less frequently (fuel, bullets, bombs) will be sent out less frequently.\\nUnchanging properties such as the team of a plane, or the type of a plane will only be sent out\\nonce when the object is created.\"}]\n21:[\"$\",\"p\",null,{\"children\":\"Let's start with a new scenario.\\nA game tick has just been calculated between two players who are flying.\\nBoth of their plane's X and Y coordinates have been updated, and one of the plane's\\nfuel has decreased.\\nWe want to send this information in a packet to the client:\"}]\n"])</script><script>self.__next_f.push([1,"22:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"{\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"type\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"data\"}],\": {\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\": {\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"4\"}],\": {\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"type\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"x\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"994\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"y\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"174\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"fuel\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"226\"}],\"}, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"5\"}],\": {\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"type\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"x\"}],\": -\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1513\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"y\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"238\"}],\"}}}}\\n\"]}]}]\n"])</script><script>self.__next_f.push([1,"23:[\"$\",\"div\",null,{\"className\":\"subtitle\",\"children\":[\"$\",\"p\",null,{\"children\":\"An example packet with changes to game objects.\"}]}]\n24:[\"$\",\"p\",null,{\"children\":[\"The highest level \",[\"$\",\"code\",null,{\"children\":\"type\"}],\" is an enum that tells the client what type of packet is coming.\\n\",[\"$\",\"code\",null,{\"children\":\"data\"}],\" holds a nested object of game objects,\\nand each game object holds objects which are indexed by their own unique ID's.\\nEach instance of a game object only has its own changes included.\"]}]\n25:[\"$\",\"p\",null,{\"children\":\"Our example above is a 100 byte string for two planes. It would have been 200 bytes if we used the \\\"send everything\\\"\\napproach with two planes.\\nWith just a little effort we've already reduced the size by \u003e50%,\\nand the savings would be significantly greater the more planes you add.\"}]\n26:[\"$\",\"p\",null,{\"children\":\"Only sending a small JSON object with relevant changes to game objects already saves us\\nquite a bit of data,\\nbut once again, we can do better.\"}]\n27:[\"$\",\"h3\",null,{\"children\":\"Binary Compression\"}]\n28:[\"$\",\"p\",null,{\"children\":[\"since JSON is sent over the network as a string, it has a lot of overhead.\\nLabels such as \",[\"$\",\"code\",null,{\"children\":\"\\\"fuel\\\":\"}],\", and\\ncharacters such as \",[\"$\",\"code\",null,{\"children\":\"\\\"\"}],\", \",[\"$\",\"code\",null,{\"children\":\":\"}],\", and \",[\"$\",\"code\",null,{\"children\":\",\"}],\" are all just fluff in order to keep the structure\\nof the JSON object in tact.\\nIn fact, we wouldn't even need to have these labels if we knew the order and size of the properties of\\nan object and sent them in a specific way every time.\\nBy creating our own custom binary protocol, we can cram a lot of information\\ninto a small stream of bytes.\"]}]\n29:[\"$\",\"p\",null,{\"children\":\"The compression algorithm is as follows:\"}]\n2a:[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Always begin each packet with 1 byte to describe the type of data being sent so the client knows how to read it.\"}],\"\\n\"]}]\n2b:[\"$\",\"p\",null,{\"children\":\"For each game o"])</script><script>self.__next_f.push([1,"bject (repeat):\"}]\n2c:[\"$\",\"ol\",null,{\"start\":\"2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Add one byte for type of object\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Follow that with a two byte unique ID for that object (allows 2^16 = 65,536 unique IDs for each type)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Use \",[\"$\",\"code\",null,{\"children\":\"n\"}],\" number of bytes as a bitmask, where bits set to \",[\"$\",\"code\",null,{\"children\":\"1\"}],\" are the properties that are being sent immediately proceeding this bitmask, in order.\"]}],\"\\n\"]}]\n2d:[\"$\",\"p\",null,{\"children\":\"For each property set in the bitmask:\"}]\n2e:[\"$\",\"ol\",null,{\"start\":\"5\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Write \",[\"$\",\"code\",null,{\"children\":\"n\"}],\" bytes depending on how large the property is\"]}],\"\\n\"]}]\n2f:[\"$\",\"p\",null,{\"children\":\"And repeat until the end.\"}]\n30:[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/lento-remake/binary.png\",\"alt\":\"binary\"}]}]\n31:[\"$\",\"div\",null,{\"className\":\"subtitle\",\"children\":[\"$\",\"p\",null,{\"children\":\"Example packet of my custom binary game object protocol.\"}]}]\n32:[\"$\",\"p\",null,{\"children\":\"Applying that compression to the JSON data, we now have all of that information packed into\\nthis little binary update which is only 20 bytes (shown as a hexadecimal string here with spaces for ease of reading):\"}]\n"])</script><script>self.__next_f.push([1,"33:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-apache\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-attribute\",\"children\":\"07\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"07\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"00\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"04\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"43\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"00\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"03\"}],\" E2 \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"00\"}],\" AE E2 \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"07\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"00\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"05\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"03\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"00\"}],\" FA \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"17\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"00\"}],\" EE\\n\"]}]}]\n"])</script><script>self.__next_f.push([1,"34:[\"$\",\"p\",null,{\"children\":\"~5x smaller than our previous optimization, and ~20x smaller than the \\\"send the world\\\" approach.\"}]\n35:[\"$\",\"h2\",null,{\"children\":\"Final Thoughts\"}]\n"])</script><script>self.__next_f.push([1,"36:[\"$\",\"p\",null,{\"children\":\"All and all, it was a fun project to work on,\\nBut it was mentally taxing having to write nearly everything from scratch.\\nIt was enjoyable to see the game start to have new life again.\\nAt one point, we even had the programmer of the original game join our server.\\nHe searched for the original sources to try and help us,\\nbut they were long gone and it seems like they will never be shared if they do still exist somewhere.\\nI wish I were able to figure out how to fix the physics, but I can't.\\nIt seems like this is where this project ends for now.\\nIf the original sources are found, or someone figures out the physics,\\nI will complete the game, but that doesn't seem likely.\"}]\n"])</script></body></html>